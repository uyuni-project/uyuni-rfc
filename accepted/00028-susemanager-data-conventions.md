- Feature Name: Define conventions for naming data in SUSE Manager
- Start Date: 2016-10-25
- RFC PR: 

# Summary
[summary]: #summary

Define how we name pillar, grains and possible other data for SUSE Manager.

# Motivation
[motivation]: #motivation

When SUSE Manager defines pillar data to be used in state files, we use some name and define it
as a top level key. There is a risk that two states use the same key or we conflict with
pillar data defined by the customer.

The same applies for custom grains and other data like events, beacons, etc.

# Detailed design
[design]: #detailed-design

## Conventions for pillar data

1. all pillar data generated by SUSE Manager should be created under the top namespace `susemanager`.
2. pillar data for a specific state should use the state name as second level namespace.

### Examples

distupgrade/init.sls:

* susemanager:distupgrade:dryrun
* susemanager:distupgrade:channels

bootstrap/init.sls:

* susemanager:bootstrap:master
* susemanager:bootstrap:minion_pub
* susemanager:bootstrap:minion_pem
* susemanager:bootstrap:activation_key

## Conventions for custom grains

All custom grains defined by SUSE Manager should have the `mgr_` prefix. A hierarchy cannot be used, because salt
do not do a deep merge of grain data. So later defined grains would overwrite previously defined once.

### Example:

```
livepatching.py

return {'mgr_kernel_live_version': 'kgraft_patch-1_2_2'}
```

# Drawbacks
[drawbacks]: #drawbacks

Changing pillar data might result in problems. In case we want to apply this rules also for already existing states
we need to think about enforcing regeneration of pillar data.

# Alternatives
[alternatives]: #alternatives

What other designs have been considered? What is the impact of not doing this?

# Unresolved questions
[unresolved]: #unresolved-questions

## Should this rule apply also for static pillar data like our gpgkeys definitions?

See susemanager-sls/pillar_data/gpgkeys.yml

They should be moved to the *susemanager* namespace.

```
susemanager:
  gpgkeys:
    res6tools:
      name: gpg-pubkey-307e3d54-53287cdc
      file: sle11-gpg-pubkey-307e3d54-53287cdc.key
    res7tools:
      name: gpg-pubkey-39db7c82-510a966b
      file: sle12-gpg-pubkey-39db7c82-510a966b.key
    res:
      name: gpg-pubkey-0182b964-4911a584
      file: res-gpg-pubkey-0182b964-4911a584.key
```
